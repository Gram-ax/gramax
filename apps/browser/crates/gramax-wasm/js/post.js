var P=new TextEncoder,C=new TextDecoder,O=self,k=async(w)=>{let A=await O.wasm._ralloc(w.byteLength);return new Uint8Array(O.wasm.wasmMemory.buffer).set(w,A),A},Q=async(w)=>{let A=P.encode(w),U=await k(A);return[A.byteLength,U]},T=(w)=>{let A=W(w);if(A?.buf.length==0)return{buf:void 0,ok:A.ok};return{buf:C.decode(A.buf),ok:A.ok}},W=(w)=>{let A=new Uint8Array(O.wasm.wasmMemory.buffer),U=new DataView(A.buffer,w,9),D=U.getUint32(0,!0),j=U.getUint32(4,!0),M=U.getUint8(8)!==1,V=A.slice(j,j+D);return O.wasm._rfree(j,D),O.wasm._rfree(w,9),{buf:V,ok:M}};self.ptr2str=T;self.ptr2bytes=W;self.str2ptr=Q;self.emscriptenhttpconnections={};var E=new BroadcastChannel("pthreads-broadcast"),L=async(w,A)=>{self.wasm={wasmMemory:Module.HEAPU8,_rfree:Module._rfree,_ralloc:Module._ralloc};let U=Module._set_last_http_error,[D,j]=await Q(A);await U(w,j,D)},H=new TextDecoder,J=async(w,A,U)=>{if(w>=200&&w<300)return!1;try{if(A.length>4096)A=A.slice(0,4096);let D=H.decode(A);if(w===0&&D===""){w=999;let j=U?new URL(U).hostname:"";D=`Failed to send request to '${U}': domain '${j}' unreachable or CORS headers incorrect`}await L(w,D)}catch(D){console.error("failed to set last http error",D)}return!0};E.addEventListener("message",(w)=>{if(w.data.type==="cancel"){if(self.cancelToken===w.data.id&&Date.now()-w.data.date<1000)Object.values(self.emscriptenhttpconnections).forEach((A)=>{A?.abortController?.abort()})}});var F=(w)=>{self.wasm={wasmMemory:Module.HEAPU8,_rfree:Module._rfree,_ralloc:Module._ralloc};let A=Module._get_store(w);return T(A)?.buf};Object.assign(Module,{em_lfs_http_init:function(w,A,U,D){let j=parseInt(Math.random()*1e6);if(!U)U="GET";let M=new XMLHttpRequest,V=new AbortController,m=F(1),q=F(2),G=F(3)||"oauth2",K=F(4);w=m&&m!=="null"?m+w.replace(/https?:\/\//,"/"):w,M.open(U,w,!0);let _={"Content-Type":"application/vnd.git-lfs+json, charset=utf-8"};if(q)_["x-private-token"]=q;if(G)_["x-git-username"]=G;if(K)_["x-protocol"]=K;if(M.responseType="arraybuffer",M.withCredentials=!0,D)_.Authorization=`Bearer ${D}`;return self.emscriptenhttpconnections[j]={xhr:M,url:w,headers:_,abortController:V,resultbufferpointer:0,buffersize:A},j},em_lfs_http_set_header:function(w,A,U){let D=self.emscriptenhttpconnections[w];D.headers[A]=U},em_lfs_http_send:function(w,A){return new Promise((D)=>{let j=self.emscriptenhttpconnections[w];if(!j)return D(-1);let{xhr:M,url:V}=j;for(let[m,q]of Object.entries(j.headers))M.setRequestHeader(m,q);M.onload=async function(m){let q=await J(M.status,M.response);D(q?-M.status:w)},M.onerror=async function(m){await J(M.status,M.response,V),D(-M.status)},M.onabort=function(){D(-999)},M.send(A)})},em_git_http_init:async function(w,A,U,D){return new Promise((M)=>{let V=parseInt(Math.random()*1e6);if(!U)U="GET";let m=F(1),q=F(2),G=F(3)||"git",K=F(4),_=new XMLHttpRequest,X=new AbortController;if(w=m&&m!=="null"?m+w.replace(/https?:\/\//,"/"):w,_.open(U,w,!0),_.responseType="arraybuffer",_.withCredentials=!0,q)_.setRequestHeader("x-private-token",q);if(G)_.setRequestHeader("x-git-username",G);if(K)_.setRequestHeader("x-protocol",K);if(self.emscriptenhttpconnections[V]={xhr:_,abortController:X,resultbufferpointer:0,buffersize:A},D)Object.keys(D).forEach((B)=>_.setRequestHeader(B,D[B]));let Y=Date.now(),Z=0,$=0;if(_.onprogress=(B)=>{let R=Date.now();if(R-Y>1000)Z=B.loaded-$,$=B.loaded,Y=R,self.postMessage({type:"remote-progress",progress:{type:"download",data:{id:self.cancelToken,bytes:B.loaded,downloadSpeedBytes:Z}}})},X.signal.addEventListener("abort",()=>{_.abort()}),U==="GET")_.onload=async function(B){await J(_.status,_.response),M(V)},_.onerror=async function(B){await J(_.status,_.response,w),M(V)},_.onabort=function(){M(V)},_.send();else M(V)})},em_http_write:function(w,A,U){let D=self.emscriptenhttpconnections[w],j=new Uint8Array(Module.HEAPU8.buffer,A,U).slice(0);if(!D.content)D.content=j;else{let M=new Uint8Array(D.content.length+j.length);M.set(D.content),M.set(j,D.content.length),D.content=M}},em_http_read:function(w,A,U){function D(M,V){let m=self.emscriptenhttpconnections[w];if(!m?.xhr?.response?.byteLength||m.xhr.response.byteLength===0)return 0;let q=m.xhr.response.byteLength-m.resultbufferpointer;if(q>V)q=V;let G=new Uint8Array(m.xhr.response,m.resultbufferpointer,q);return writeArrayToMemory(G,M),m.resultbufferpointer+=q,q}return new Promise((M)=>{let V=self.emscriptenhttpconnections[w];if(V.content)V.xhr.onload=async function(m){let q=await J(V.xhr.status,V.xhr.response);M(q?-V.xhr.status:D(A,U))},V.xhr.onabort=function(){M(-999)},V.xhr.onerror=function(m){J(V.xhr.status,V.xhr.response),M(-V.xhr.status)},V.xhr.send(V.content.buffer),V.content=null;else M(D(A,U))})},em_http_free:function(w){delete self.emscriptenhttpconnections[w]}});
